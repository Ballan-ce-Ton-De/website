import{ap as fe,a8 as U,aq as ne,r as D,D as q,a2 as pe,a1 as le,v as V,a0 as ve,ar as he,i as O,k as A,j as L,m as R,h as r,W as de,aj as F,ak as W,y as ce,a6 as me,a9 as ge,L as ye,as as ae,K as xe,F as be,at as Ce,w as ke,R as Te,A as N,l as z,T as se,S as Ie,I as _,V as Ee,_ as Se,E as ie,U as Ke,B as we}from"./Dp1I7d1F.js";import _e from"./B933kHg1.js";import{t as re}from"./DYQ_yBqI.js";import{_ as Ae,M as Ve,a as Re}from"./BmZzkZJr.js";import{u as Be}from"./BX6Uyz9q.js";import"./Bbg1c_qd.js";function Le(s){const n=fe("",1e3);return{search:n,handleTypeaheadSearch:(E,l)=>{n.value=n.value+E;{const u=U(),p=l.map(y=>{var S,b;return{...y,textValue:((S=y.value)==null?void 0:S.textValue)??((b=y.ref.textContent)==null?void 0:b.trim())??""}}),i=p.find(y=>y.ref===u),g=p.map(y=>y.textValue),K=Me(g,n.value,i==null?void 0:i.textValue),x=p.find(y=>y.textValue===K);return x&&x.ref.focus(),x==null?void 0:x.ref}},resetTypeahead:()=>{n.value=""}}}function $e(s,n){return s.map((e,f)=>s[(n+f)%s.length])}function Me(s,n,e){const E=n.length>1&&Array.from(n).every(g=>g===n[0])?n[0]:n,l=e?s.indexOf(e):-1;let u=$e(s,Math.max(l,0));E.length===1&&(u=u.filter(g=>g!==e));const i=u.find(g=>g.toLowerCase().startsWith(E.toLowerCase()));return i!==e?i:void 0}function G(s,n,e){const f=s.findIndex(p=>ne(p,n)),E=s.findIndex(p=>ne(p,e));if(f===-1||E===-1)return[];const[l,u]=[f,E].sort((p,i)=>p-i);return s.slice(l,u+1)}function H(s){return s.reduce((n,e)=>(n.push(e),e.children&&n.push(...H(e.children)),n),[])}function De(s,n){const e=D(),f=(l,u)=>{if(n.multiple&&Array.isArray(s.value))if(n.selectionBehavior==="replace")s.value=[l],e.value=l;else{const p=s.value.findIndex(i=>u(i));p!==-1?s.value.splice(p,1):s.value.push(l)}else n.selectionBehavior==="replace"?s.value={...l}:!Array.isArray(s.value)&&u(s.value)?s.value=void 0:s.value={...l};return s.value};function E(l,u,p,i){var y;if(!(e!=null&&e.value)||!n.multiple||!Array.isArray(s.value))return;const K=(y=p().filter(S=>S.ref.dataset.disabled!=="").find(S=>S.ref===u))==null?void 0:y.value;if(!K)return;let x=null;switch(l){case"prev":case"next":{x=G(i,e.value,K);break}case"first":{x=G(i,e.value,i==null?void 0:i[0]);break}case"last":{x=G(i,e.value,i==null?void 0:i[i.length-1]);break}}s.value=x}return{firstValue:e,onSelectItem:f,handleMultipleReplace:E}}const[Ne,We]=ve("TreeRoot"),Oe=q({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:s=>s.children},selectionBehavior:{default:"toggle"},multiple:{type:Boolean},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(s,{emit:n}){const e=s,f=n,{items:E,multiple:l,disabled:u,propagateSelect:p,dir:i}=pe(e),{handleTypeaheadSearch:g}=Le(),K=Be(i),x=D(),y=D(!1),S=he(),b=le(e,"modelValue",f,{defaultValue:e.defaultValue??(l.value?[]:void 0),passive:e.modelValue===void 0,deep:!0}),o=le(e,"expanded",f,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:h,handleMultipleReplace:t}=De(b,e),d=V(()=>l.value&&Array.isArray(b.value)?b.value.map(a=>e.getKey(a)):[e.getKey(b.value??{})]);function c(a,v=1,T){return a.reduce((I,w,B)=>{const $=e.getKey(w),M=e.getChildren(w),P=o.value.includes($),j={_id:$,value:w,index:B,level:v,parentItem:T,hasChildren:!!M,bind:{value:w,level:v,"aria-setsize":a.length,"aria-posinset":B+1}};return I.push(j),M&&P&&I.push(...c(M,v+1,w)),I},[])}const m=V(()=>{const a=e.items;return o.value.map(v=>v),c(a??[])});function C(a){var v;if(y.value)S.trigger(a);else{const T=((v=x.value)==null?void 0:v.getItems())??[];g(a.key,T)}}function k(a){if(y.value)return;const v=Ve[a.key];me(()=>{var T;t(v,U(),(T=x.value)==null?void 0:T.getItems,m.value.map(I=>I.value))})}return We({modelValue:b,selectedKeys:d,onSelect:a=>{var I;const v=w=>e.getKey(w??{})===e.getKey(a),T=e.multiple&&Array.isArray(b.value)?((I=b.value)==null?void 0:I.findIndex(v))!==-1:void 0;if(h(a,v),e.propagateSelect&&e.multiple&&Array.isArray(b.value)){const w=H(e.getChildren(a)??[]);T?b.value=[...b.value].filter(B=>!w.some($=>e.getKey(B??{})===e.getKey($))):b.value=[...b.value,...w]}},expanded:o,onToggle(a){if(!(a?e.getChildren(a):void 0))return;const T=e.getKey(a)??a;o.value.includes(T)?o.value=o.value.filter(I=>I!==T):o.value.push(T)},getKey:e.getKey,getChildren:e.getChildren,items:E,expandedItems:m,disabled:u,multiple:l,dir:K,propagateSelect:p,isVirtual:y,virtualKeydownHook:S,handleMultipleReplace:t}),(a,v)=>(A(),O(r(Ae),{ref_key:"rovingFocusGroupRef",ref:x,"as-child":"",orientation:"vertical",dir:r(K)},{default:L(()=>[R(r(de),{role:"tree",as:a.as,"as-child":a.asChild,"aria-multiselectable":r(l)?!0:void 0,onKeydown:[C,F(W(k,["shift"]),["up","down"])]},{default:L(()=>[ce(a.$slots,"default",{flattenItems:m.value,modelValue:r(b),expanded:r(o)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Pe="tree.select",je="tree.toggle",ze=q({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(s,{expose:n,emit:e}){const f=s,E=e,l=Ne(),{getItems:u}=ge(),p=V(()=>!!l.getChildren(f.value)),i=V(()=>{const t=l.getKey(f.value);return l.expanded.value.includes(t)}),g=V(()=>{const t=l.getKey(f.value);return l.selectedKeys.value.includes(t)}),K=V(()=>{if(l.propagateSelect.value&&g.value&&p.value&&Array.isArray(l.modelValue.value))return!H(l.getChildren(f.value)||[]).every(d=>l.modelValue.value.find(c=>l.getKey(c)===l.getKey(d)))});function x(t){if(p.value)if(i.value){const d=u().map(a=>a.ref),c=U(),m=d.indexOf(c),k=[...d].slice(m).find(a=>Number(a.getAttribute("data-indent"))===f.level+1);k&&k.focus()}else h(t)}function y(t){if(i.value)h(t);else{const d=u().map(a=>a.ref),c=U(),m=d.indexOf(c),k=[...d].slice(0,m).reverse().find(a=>Number(a.getAttribute("data-indent"))===f.level-1);k&&k.focus()}}async function S(t){E("select",t),!(t!=null&&t.defaultPrevented)&&l.onSelect(f.value)}async function b(t){E("toggle",t),!(t!=null&&t.defaultPrevented)&&l.onToggle(f.value)}async function o(t){if(!t)return;const d={originalEvent:t,value:f.value,isExpanded:i.value,isSelected:g.value};ae(Pe,S,d)}async function h(t){if(!t)return;const d={originalEvent:t,value:f.value,isExpanded:i.value,isSelected:g.value};ae(je,b,d)}return n({isExpanded:i,isSelected:g,isIndeterminate:K,handleToggle:()=>l.onToggle(f.value),handleSelect:()=>l.onSelect(f.value)}),(t,d)=>(A(),O(r(Re),{"as-child":"",value:t.value,"allow-shift-key":""},{default:L(()=>[R(r(de),ye(t.$attrs,{role:"treeitem",as:t.as,"as-child":t.asChild,"aria-selected":g.value,"aria-expanded":p.value?i.value:void 0,"aria-level":t.level,"data-indent":t.level,"data-selected":g.value?"":void 0,"data-expanded":i.value?"":void 0,onKeydown:[F(W(o,["self","prevent"]),["enter","space"]),d[0]||(d[0]=F(W(c=>r(l).dir.value==="ltr"?x(c):y(c),["prevent"]),["right"])),d[1]||(d[1]=F(W(c=>r(l).dir.value==="ltr"?y(c):x(c),["prevent"]),["left"]))],onClick:d[2]||(d[2]=W(c=>{o(c),h(c)},["stop"]))}),{default:L(()=>[ce(t.$slots,"default",{isExpanded:i.value,isSelected:g.value,isIndeterminate:K.value,handleSelect:()=>r(l).onSelect(t.value),handleToggle:()=>r(l).onToggle(t.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Fe={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-(--ui-border-muted) rounded-[calc(var(--ui-radius)*1.5)]",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-(--ui-border-muted) overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-(--ui-border)",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-[calc(var(--ui-radius)*1.5)] focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-(--ui-text-highlighted) before:bg-(--ui-bg-elevated)"},false:{link:["hover:text-(--ui-text-highlighted) hover:before:bg-(--ui-bg-elevated)/50","transition-colors before:transition-colors"]}}}},Ue=Se;var oe,ue;const Ge=re({extend:re(Fe),...((ue=(oe=Ue.uiPro)==null?void 0:oe.prose)==null?void 0:ue.codeTree)||{}}),qe=q({__name:"CodeTree",props:{defaultValue:{},class:{},ui:{}},setup(s){const n=s,e=xe(),f=be(),[E,l]=Ce(),u=Ge(),p=D(n.defaultValue?{path:n.defaultValue}:void 0),i=D(),g=D(1),K=V(()=>{var o,h;return g.value,((h=(o=e.default)==null?void 0:o.call(e))==null?void 0:h.flatMap(S).filter(Boolean))||[]}),x=V(()=>y(K.value));function y(o){const h=new Map,t=[];o.forEach(c=>{const m=c.label.split("/");let C="";m.forEach((k,a)=>{var v,T;if(C=C?`${C}/${k}`:k,!h.has(C)){const I={label:k,path:C,...a<m.length-1&&{children:[]}};h.set(C,I),a===0?t.push(I):(T=(v=h.get(m.slice(0,a).join("/")))==null?void 0:v.children)==null||T.push(I)}})});const d=c=>c.sort((m,C)=>!!m.children==!!C.children?m.label.localeCompare(C.label):C.children?1:-1).map(m=>({...m,children:m.children&&d(m.children)}));return d(t)}function S(o,h){var t,d,c,m;return typeof o.type=="symbol"?(t=o.children)==null?void 0:t.map(S):{label:((d=o.props)==null?void 0:d.filename)||((c=o.props)==null?void 0:c.label)||`${h}`,icon:(m=o.props)==null?void 0:m.icon,component:o}}const b=V(()=>{var t;const o=(t=p.value)==null?void 0:t.path;if(!o)return[];const h=o.split("/");return h.map((d,c)=>h.slice(0,c+1).join("/"))});return ke(p,o=>{const h=K.value.find(t=>(o==null?void 0:o.path)===t.label);h!=null&&h.component&&(i.value=h)},{immediate:!0}),Te(()=>g.value++),(o,h)=>{var d,c,m,C;const t=Ke;return A(),N(se,null,[R(r(E),null,{default:L(({items:k,level:a})=>[(A(!0),N(se,null,Ie(k,(v,T)=>{var I,w;return A(),N("li",{key:`${a}-${T}`,class:_(a>0?r(u).itemWithChildren({class:(I=n.ui)==null?void 0:I.itemWithChildren}):r(u).item({class:(w=n.ui)==null?void 0:w.item}))},[R(r(ze),{"as-child":"",level:a,value:v},{default:L(({isExpanded:B,isSelected:$})=>{var M,P,j,Y,J,Q,X,Z,ee,te;return[z("button",{class:_(r(u).link({class:(M=n.ui)==null?void 0:M.link,active:$}))},[(P=v.children)!=null&&P.length?(A(),O(t,{key:0,name:B?r(f).ui.icons.folderOpen:r(f).ui.icons.folder,class:_(r(u).linkLeadingIcon({class:(j=n.ui)==null?void 0:j.linkLeadingIcon}))},null,8,["name","class"])):(A(),O(_e,{key:1,filename:v.label,class:_(r(u).linkLeadingIcon({class:(Y=n.ui)==null?void 0:Y.linkLeadingIcon}))},null,8,["filename","class"])),z("span",{class:_(r(u).linkLabel({class:(J=n.ui)==null?void 0:J.linkLabel}))},we(v.label),3),(Q=v.children)!=null&&Q.length?(A(),N("span",{key:2,class:_(r(u).linkTrailing({class:(X=n.ui)==null?void 0:X.linkTrailing}))},[R(t,{name:r(f).ui.icons.chevronDown,class:_(r(u).linkTrailingIcon({class:(Z=n.ui)==null?void 0:Z.linkTrailingIcon}))},null,8,["name","class"])],2)):ie("",!0)],2),(ee=v.children)!=null&&ee.length&&B?(A(),N("ul",{key:0,class:_(r(u).listWithChildren({class:(te=n.ui)==null?void 0:te.listWithChildren}))},[R(r(l),{items:v.children,level:a+1},null,8,["items","level"])],2)):ie("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),z("div",{class:_(r(u).root({class:[n.class,(d=n.ui)==null?void 0:d.root]}))},[R(r(Oe),{modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=k=>p.value=k),class:_(r(u).list({class:(c=n.ui)==null?void 0:c.list})),items:x.value,"get-key":k=>k.path,"default-expanded":b.value},{default:L(()=>[R(r(l),{items:x.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),z("div",{class:_(r(u).content({class:(m=n.ui)==null?void 0:m.content}))},[(A(),O(Ee((C=i.value)==null?void 0:C.component)))],2)],2)],64)}}}),et=Object.assign(qe,{__name:"ProseCodeTree"});export{et as default};
